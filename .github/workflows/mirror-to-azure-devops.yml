name: "Mirror repository to Azure DevOps"
on:
  push:
    branches:
      - master

jobs:
  mirror:
    name: Mirror repository to Azure DevOps
    runs-on: windows-latest
    environment: AzureDevOps
    env: # Set the secret as an input
      AZORG: ${{ secrets.AZORG }}
      AZUREPAT: ${{ secrets.AZUREPAT }}
      AZUSERNAME: ${{ secrets.AZUSERNAME }}
      AZUSER_EMAIL: ${{ secrets.AZUSER_EMAIL }}
      TEST: 'TESTTTTT'
      NAME: 'testsetsetestet'
    steps:
        - name: Test Bash script
          env:
            NAME1: test1
          shell: bash
          run: |
            echo "Hello TEST: $TEST"
            echo "Hello NAME: $NAME"
            echo "Hello NAME1: $NAME1"
            #$name3 = 'testst name3'
            #echo "Hello nam3: $name3"
            
        - name: Test Powershell
          run: |
            Write-Host "Env:AZORG: $Env:AZORG"
          shell: pwsh
        - name: Checkout repository
          uses: actions/checkout@v4
          with:
            fetch-depth: 0  
        - name: Mirroring
          shell: pwsh
          run: |
            $username = ${Env:AZUSERNAME}
            $email = ${Env:AZUSER_EMAIL}
            $pat = 'bd74ocb6txp2437zaakkygi5gtydmnctdwpe7lo6zw2dqhwurhsa'
            #${Env:AZUREPAT}
            $org = ${Env:AZORG}
            git --version
            git config --global user.name $username
            git config --global user.email $email
            git config --global credential.helper manager
            git config --list
            echo "===================================="
            $url = "https://$pat@dev.azure.com/$org/MirroredPublic/_git/MirroredPublic"
            Write-Host "url: $url"
            git clone https://w5-devops-pg:3mn56mjw6w6p3hnkxexdb32ee4w3toq2c326ziovtuv4rwmkp2mq@dev.azure.com/w5-devops-pg/DevOps%20Playground/_git/Playground2
            #git push --mirror $url
        
