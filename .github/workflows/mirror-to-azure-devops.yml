name: "Mirror repository to Azure DevOps"

on:
  push:
    branches:
      - master

jobs:
  mirror:
    name: Mirror repository to Azure DevOps
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup dotnet cli
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
          
      - name: Install Aspire workload
        run: dotnet workload restore 
        
      - name: Build whole .net solution before mirroring
        run: dotnet build
        
      - name: Mirror development repository to the deployement repository on Azure DevOps
        run: |
          git remote add AzureDevOps https://trungdang2024:bs6zhcg6jeuopl2ea7xp3o3kvm5e2lygl75fpn7azrhu3izqeyzq@dev.azure.com/trungdang2024/MirroredLearningAspire/_git/MirroredLearningAspire
          git push -u AzureDevOps --all
